<!DOCTYPE HTML>
<html>
	<head>
		<title>Photark Mobile</title>
		<link href="css/jquery.mobile-1.1.0.min.css" rel="stylesheet"
		type="text/css" />
		<link href="css/mobiscroll-2.0.full.min.css" rel="stylesheet"
		type="text/css" />
		<script type="text/javascript" src="scripts/jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="scripts/jquery.mobile-1.1.0.min.js"></script>
		<script type="text/javascript" src="scripts/mobiscroll-2.0.full.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="scripts/cordova-1.8.0.js" ></script>
		<script src="scripts/cdv-plugin-fb-connect.js"></script><!--Facebook Connect Plugin-->
		<script src="scripts/facebook_js_sdk.js"></script><!--Facebook JS SDK-->
		<script type="text/javascript" charset="utf-8" src="scripts/contacts.js" ></script>
		<script type="text/javascript" charset="utf-8" src="scripts/geoLocation.js" ></script>
		<script type="text/javascript" charset="utf-8" src="scripts/utils.js" ></script>
		<script type="text/javascript" charset="utf-8" src="scripts/dataAccess.js"></script>
		<script type="text/javascript">
			var pictureSource;
			// picture source
			var destinationType;
			// sets the format of returned value

			// Wait for device
			document.addEventListener("deviceready", onDeviceReady, false);

			function onDeviceReady() {
				pictureSource = navigator.camera.PictureSourceType;
				destinationType = navigator.camera.DestinationType;
				getContacts();
				$('#ContactsPage li a').live('click', function() {
					var name = $(this).text();
					onContactsClick(name);
				});
				getLocation();
				openDB();
			}

			//Document ready function
			$(function() {
				// Handler for Date Picker

				$('#editDate').scroller({
					preset : 'date',
					invalid : {
						daysOfWeek : [0, 6],
						daysOfMonth : ['5/1', '12/24', '12/25']
					},
					theme : 'default',
					display : 'modal',
					mode : 'scroller',
					dateOrder : 'mmD ddy'
				});

				//Handler for time picker
				$('#editTime').scroller({
					preset : 'time',
					theme : 'default',
					display : 'modal',
					mode : 'scroller'
				});

			});

			function onPhotoDataSuccess(imageData) {
				var largeImage = document.getElementById('largeImage');
				largeImage.style.display = 'block';
				largeImage.src = "data:image/jpeg;base64," + imageData;
			}

			function onPhotoURISuccess(imageURI) {
				var largeImage = document.getElementById('largeImage');
				largeImage.style.display = 'block';
				largeImage.src = imageURI;
				//$('#myButton').removeClass('ui-disabled');
				$('#toolbar_icons').show();
				$('#toolbar_message').hide();
				$('#toolbar').listview("create");
				uri= imageURI;
				window.resolveLocalFileSystemURI(imageURI, onFileEntryComplete, isFail);
				viewData();
			}

			function onFileEntryComplete(fileEntry) {
				fileEntry.file(successFile, isFail);
				fileEntry.getMetadata(successMetadata, isFail);
			}

			function successMetadata(metadata) {
				$("#metadata").append("<p> LastModified:" + metadata.modificationTime + "</p> ");

			}

			function successFile(file) {
				$("#metadata").append("<p> Size:" + file.size + "bytes </p> <p> Type:" + file.type + " </p>");

			}

			function isFail() {
				alert("Error Occured");
			}

			function capturePhoto() {
				// Take picture using device camera and retrieve image
				navigator.camera.getPicture(onPhotoURISuccess, onFail, {
					destinationType : navigator.camera.DestinationType.FILE_URI,
					quality : 50
				});

			}

			function getPhoto(source) {
				// Retrieve image file location from specified source
				navigator.camera.getPicture(onPhotoURISuccess, onFail, {
					quality : 50,
					destinationType : destinationType.FILE_URI,
					sourceType : source
				});
			}

			function onFail(message) {
				alert('Failed because: ' + message);
			}

			function editDateOnClick() {
				$('#editDate').scroller('show');
			}

			function editTimeOnClick() {
				$('#editTime').scroller('show');
			}

			function save() {
				nickname = $("#nickName").val();
				date = $("#editDate").val();
				time = $("#editTime").val();
				locaton = $("#editLocation").val();
				people=$("#editPeople").val().split(",");
				description=$("#editDiscription").val();
				updateDB();
			}
			
			//This method load existing metadata to edit metadata page on page load
			$('#EditMetadata').live('pageshow', function () {
				$("#nickName").val(getNickname());
				$("#editDate").val(getDate());
				$("#editTime").val(getTime());
				$("#editLocation").val(getLocation());
				$("#editDiscription").val(getDescription());
				var people=getPeople();
				var s="";
				for (var i=0; i < people.length; i++) {
				  s=s+people[i]+',';
				};
				$("#editPeople").val(s);
			});
			
		</script>

	</head>
	<body>
		<!-- Page Start-->
		<div id="main" data-role="page" data-theme="b">
			<!-- Page Header Start -->
			<div data-role="header" data-position="fixed">
				<h1>PhotArc Mobile</h1>
			</div>
			<!-- Page Header End -->
			<!-- Page Body Start -->
			<div id="a" data-role="content" align="center">
				<a href="#" data-role="button" onclick="capturePhoto()"
				data-theme="b">Capture Photo</a>
				<br>
				<a href="#"
				data-role="button" onclick="getPhoto(pictureSource.PHOTOLIBRARY)"
				data-theme="b">From Photo Library</a>
				<br>
				<a href="#webAlbum"
				data-role="button" data-theme="b">Web Album</a>
				<br>
				<img id="largeImage"
				src="images/logo.png" height="200" width="200" />
				 <div id="metadata"></div>
			</div>
			<!-- Page Body End -->
			<!-- Page Footer Start -->
			<div data-role="footer" data-position="fixed" >
				<div id="toolbar_message" style="text-align: center">
					<a href="#" data-role="button" data-icon="search">Search</a>
				</div>
				<div id="toolbar_icons" style="display: none;text-align: center" >
					<a href="#EditMetadata" data-role="button" data-icon="plus" data-transition="flip">Edit Metadata</a>
					<a href="#search_photoes" data-role="button" data-icon="search">Search</a>
					<a href="#ConfirmDelete" data-role="button" data-icon="delete" data-rel="dialog" data-transition="pop">Delete</a>
				</div>
			</div>
			<!-- Page Footer End -->
		</div>

		<!-- Edit metadata page -->
		<div id="EditMetadata" data-role="page">
			<div data-role="header" data-position="fixed">
				<h1>Edit Metadata</h1>
			</div>

			<!-- Form Content -->
			<div data-role="content">

				<div data-role="fieldcontain">
					<label for="name"> Photo nick name: </label>
					<input type="text"
					id="nickName" value="" />
				</div>
				<div data-role="fieldcontain">
					<label for="name"> Date: </label>
					<input type="text" name="name"
					id="editDate" value="" onclick="editDateOnClick()" />
				</div>
				<div data-role="fieldcontain">
					<label for="name"> Time: </label>
					<input type="text" name="name"
					id="editTime" value="" onclick="editTimeOnClick()" />
				</div>
				<div data-role="fieldcontain">
					<label for="textarea"> People: </label>
					<textarea cols="40" rows="8" name="textarea" id="editPeople"></textarea>
					<a href="#ContactsPage" data-role="button" data-theme="a"  data-mini="true">Browse</a>
				</div>

				<div data-role="fieldcontain">
					<label for="textarea"> Discription </label>
					<textarea cols="40" rows="8" name="textarea" id="editDiscription"></textarea>
				</div>
				<div data-role="fieldcontain">
					<label for="search"> Location </label>
					<input type="search" name="searchbox" id="locationSearch" value="" />
				</div>
			</div>
			<div data-role="footer" data-position="fixed" style="text-align: center">
				<a href="index.html" data-icon="check" onclick="save()">Save</a>
				<a href="index.html" data-icon="delete">Cancel</a>
			</div>
		</div>
		<!-- Page End -->

		<!-- Contacts List Page-->
		<div id="ContactsPage" data-role="page">
			<div data-role="header">
				<h1>Contacts</h1>
			</div>
			<div data-role="content">

				<ul id="allContacts" data-role="listview" data-filter="true" data-inset="true">

				</ul>
			</div>
		</div>
		<!-- Page End -->

		<!-- Confirm Delete Dialog-->
		<div id="ConfirmDelete" data-role="page">
			<div data-role="header">
				<h1>Confirm Delete</h1>
			</div>
			<div data-role="content">

				<p>
					Are you sure you want to delete this photo?
				</p>
				<a href="index.html"
				data-role="button" onclick="deleteFile()"
				data-theme="b">Delete</a>
				<a href="index.html"
				data-role="button"
				data-theme="b">Cancel</a>
			</div>
		</div>
		<!-- Page End -->
		<!-- User's Web Album -->
		<div id="webAlbum" data-role="page">
			<!-- Page Header Start -->
			<div data-role="header" data-position="fixed">
				<h1>PhotArc Mobile</h1>
			</div>
			<!-- Page Header End -->
			<!-- Content Start-->
			<div id="a" data-role="content" align="center">
				<h3>Facebook</h3>
				<a href="#" data-role="button" onclick="login()"
				data-theme="b">Login</a>
				<a href="#" data-role="button" onclick="me()"
				data-theme="b">Get Friends</a>
				<div id="data">loading ...</div>    
				<script>
					if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
					if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
					if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');
					
					FB.Event.subscribe('auth.login', function(response) {
									   /*alert('auth.login event');*/
									   });
					
					FB.Event.subscribe('auth.logout', function(response) {
									   alert('auth.logout event');
									   });
					
					FB.Event.subscribe('auth.sessionChange', function(response) {
									   alert('auth.sessionChange event');
									   });
					
					FB.Event.subscribe('auth.statusChange', function(response) {
									   /*alert('auth.statusChange event');*/
									   });
					
					function getLoginStatus() {
						FB.getLoginStatus(function(response) {
										  if (response.status == 'connected') {
										  alert('logged in');
										  } else {
										  alert('not logged in');
										  }
										  });
					}
					var friendIDs = [];
					var fdata;
					function me() {
						FB.api('/me/friends', { fields: 'id, name, picture' },  function(response) {
							   if (response.error) {
							   alert(JSON.stringify(response.error));
							   } else {
							   var data = document.getElementById('data');
							   fdata=response.data;
							   console.log("fdata: "+fdata);
							   response.data.forEach(function(item) {
													 var d = document.createElement('div');
													 d.innerHTML = "<img src="+item.picture+"/>"+item.name;
													 data.appendChild(d);
													 });
							   }
							var friends = response.data;
							console.log(friends.length); 
							for (var k = 0; k < friends.length && k < 200; k++) {
								var friend = friends[k];
								var index = 1;

								friendIDs[k] = friend.id;
								//friendsInfo[k] = friend;
							}
							console.log("friendId's: "+friendIDs);
							   });
					}         
					function login() {
						FB.login(
								 function(response) {
								 if (response.session) {
								 alert('logged in');
								 } else {
								 /*alert('not logged in');*/
								 }
								 },
								 { scope: "user_photos" }
								 );
					}            
					document.addEventListener('deviceready', function() {
											  try {
											  FB.init({ appId: "423746790989627", nativeInterface: CDV.FB, useCachedDialogs: false });
											  document.getElementById('data').innerHTML = "";
											  } catch (e) {
											  alert(e);
											  }
											  }, false);
					</script>
				</div>
				<!-- Content End -->
				<!-- Page Footer Start -->
			<div data-role="footer" data-position="fixed" >
				<div id="toolbar_message" style="text-align: center">
					<a href="#" data-role="button" data-icon="search">Search</a>
				</div>
				<div id="toolbar_icons" style="display: none;text-align: center" >
					<a href="#EditMetadata" data-role="button" data-icon="plus" data-transition="flip">Edit Metadata</a>
					<a href="#" data-role="button" data-icon="search">Search</a>
					<a href="#ConfirmDelete" data-role="button" data-icon="delete" data-rel="dialog" data-transition="pop">Delete</a>
				</div>
			</div>
			<!-- Page Footer End -->
		</div>
	
	<!-- Search page -->
		<div id="search_photoes" data-role="page">
			<div data-role="header" data-position="fixed">
				<h1>Search Photos</h1>
			</div>
			<div data-role="content">
				<div data-role="fieldcontain">
					<label for="search"> Enter name: </label>
					<input type="text" name="search" id="searchName" value="" />
				</div>

				<p>
					Date:
				</p>
				<div data-role="fieldcontain">
					<label for="search">From:</label>
					<input type="text" name="search" id="searchStartDate" value="" onclick="editDateOnClick()"/>
					<label for="search">To:</label>
					<input type="text" name="search" id="searchEndDate" value="" onclick="editDateOnClick()"/>
				</div>

				<div data-role="fieldcontain">
					<label for="search"> Enter location: </label>
					<input type="text" name="search" id="searchLocation" value="" />
				</div>

				<div data-role="fieldcontain">
					<label for="textarea"> People: </label>
					<textarea cols="40" rows="8" name="textarea" id="searchPeople"></textarea>
					<a href="#ContactsPage" data-role="button" data-theme="a"  data-mini="true">Browse</a>
				</div>

			</div>
			<div data-role="footer" data-position="fixed" style="text-align: center">
				<a href="#"
				data-role="button" data-mini="true" data-icon="search" onclick="search()">Search</a>
				<a href="#"
				data-role="button" data-rel="dialog" data-transition="pop" data-icon="grid" onclick="getPhoto(pictureSource.PHOTOLIBRARY)">Shaw all</a>
				<a href="index.html"
				data-role="button" data-mini="true"
				data-icon="back">Cancel</a>
			</div>
		</div>
		<!-- Page End -->

	</body>
</html>
